{% extends 'admin.html' %}
{% block seccion-contenido %}
<form method="POST" action="" enctype="multipart/form-data" >{% csrf_token %}
    {{ formulario }}
    <input type="submit" value="guardar">



<p id="showAdresses"><button data-toggle="modal" href="#addressModal" type='button' class="btn btn-block btn-default"><span class="glyphicon glyphicon-map-marker"></span> Agregar Direcciones </button></p><!-- OJO no cambiar este id, lo usa una funcion -->


<div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="addressModalLabel" aria-hidden="true"> <!-- Revisar usabilidady ARIA -->
    <div class="modal-dialog">
      <div class="modal-content modal-address">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h2 class="modal-title">Seleccionar Direcciones</h2>
        </div>
        <div class="modal-body">  <!-- !!! falta arregar apariencia en el modal window -->


			    <div class="addresses col-sm-6">
			            <div id="direccion">
                            <div class='row form-group'></div>
			            </div><!-- OJO no cambiar este id, lo usa una funcion -->
			            <div id="warning"></div><!-- OJO no cambiar este id, lo usa una funcion -->
			        </div>

			    <div class="addresses col-sm-6">
					<div class="row">
					        <div class=" form-group">
					            <label class="control-label col-sm-3">
					                Buscar
					            </label>

					             <div class="col-sm-9">
				            	    <div class="input-group">
								      <input type="text" class="form-control" id="address" size="29"/>
								      <span class="input-group-btn">
								        <input type="button" class="btn btn-default" value="Ir" onclick="geocode()">
								      </span>
								    </div><!-- /input-group -->
					            </div>

				        </div>


					     <div class="form-group">
						    <label  class="-3 control-label">Direccion</label>
						    <div class="col-md-9" >
		      			        <input type="text" id="formatedAddress" class="form-control">
						    </div>
						  </div>

					     <div class="form-group">
						    <label  class="-3 control-label">Descripcion</label>
						    <div class="col-md-9" >
		      			        <input type="text" id="descripcion" class="form-control">
						    </div>
						  </div>

				        <div class=" form-group form-section">
				            <div class="col-sm-9 col-sm-offset-3">
						        <button type='button' class="btn btn-info btn-block" onclick="addInput()"><span class="glyphicon glyphicon-plus"></span> Agregar Direccion</button>
				            </div>
				        </div>


						</div> {# /.row #}
						<div id="map">
				            <div id="map_canvas" style="width:100%; height:320px"></div>
				            <div id="crosshair"></div>
				        </div>
					          <div class="form-group">
							    <label class="-3 control-label">Lat/Lng</label>
							    <div class="col-md-9" id="ll">

							    </div>
						  </div>
			        <input type="hidden" id="latlng">
			    </div>


        </div>
        <div class="modal-footer">
          <p id="hideAddresses"><input type='button'  class="btn btn-lg btn-primary" value='Guardar' data-dismiss="modal"/></p><!-- OJO no cambiar este id, lo usa una funcion -->
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</form>
{% endblock %}

{% block js %}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/maps.js"></script>
    <script>
        $(document).ready(function(){
            $("#showAdresses").click(function(){
                setTimeout(function() {
                    var latlng = new google.maps.LatLng(34.0883632, -118.3788381);
                    var myOptions = {
                        zoom: 10,
                        center: latlng,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };
                    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

                    createMarker(latlng);
                }, 500);
            });
        });

        fields = 0;

        function addInput() {
          if (fields < 5) {
            var addr = document.getElementById('formatedAddress').value;
            var coord = document.getElementById('latlng').value;
            var desc = document.getElementById('descripcion').value;
            var yx = coord.split(",");
            document.getElementById('direccion').innerHTML +=
              "<div class='row form-group'><div class='col-xs-8'><input type='text' class='form-control' size =60 name='dir' value='"+addr+"' readonly/></div>" +
              "<input type='text' name='dir' value='"+desc+"'/>" +
              "<input type='hidden' name='dir' value='"+yx[0]+"'/>" +
              "<input type='hidden' name='dir' value='"+yx[1]+"'/>" +
              "<a class='btn btn-danger delete btn-delete'onclick='removeInput(this.parentNode)' />remove</a></div>";
            fields += 1;
          } else {
            document.getElementById('warning').innerHTML =
              "Only 5 upload addresses allowed.";
            document.form.add.disabled = true;
          }
        }

        function removeInput( el ) {
          if (fields > 0) {
            document.getElementById('warning').innerHTML = "";
            var parent = document.getElementById('direccion');
            parent.removeChild(el);
            fields -= 1;
          }
        }
    </script>
{% endblock %}