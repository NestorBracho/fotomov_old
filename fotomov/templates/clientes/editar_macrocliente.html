{% extends 'admin.html' %}
{% load bootstrap %}
{% block titulo %}
Editar Macrocliente
{% endblock %}
{% block css %}
<link href="{{ STATIC_URL }}/css/smoothness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">
<style type="text/css" xmlns="http://www.w3.org/1999/html"></style>
{% endblock %}
{% block seccion-contenido %}
<form method="POST" action="" enctype="multipart/form-data" >{% csrf_token %}

    <div class="panel panel-default">
        <div class="panel-heading">
            <h4>Datos Macrocliente</h4>
        </div>
        <div class="panel-body">
            <div class="col-sm-6">
                 {{ formulario.submarca|bootstrap}}
            </div>
            <div class="col-sm-6">
                {{ formulario.nombre | bootstrap}}
            </div>
            <div class="col-sm-6">
                {{ formulario.telefono | bootstrap }}
            </div>
            <div class="col-sm-6">
                {{ formulario.rif | bootstrap }}
            </div>
            <div class="col-sm-12">
                {{ formulario.direccion_fiscal | bootstrap }}
            </div>
            <div class="col-sm-12">
                {{ formulario.descripcion | bootstrap }}
                <!--Empieza el mapaaaaaaaaaaaaaaaaaaaaa -->
            </div>
        </div>
    </div>
       <div class="panel panel-default">
        <div class="panel-heading">
            <h4>Sedes</h4>
        </div>

            <div class="panel-body">
                <div class="col-sm-4">
                    <label class="control-label">
                        Nombre
                    </label>
                </div>
                <div class="col-sm-4">
                    <label class="control-label">
                        Locación
                    </label>
                </div>
                {% for direccion in direcciones %}
                    <div id='b-{{ direccion.id }}' class="col-sm-12">
                        <div id='sedeNom-{{ direccion.id }}' class='col-sm-4'>
                            {{ direccion.nombre }}
                            <input type="hidden" name="{{ direccion.direccion.nombre }}" value="{{ direccion.nombre }}">
                        </div>
                        <div class='col-sm-4'>
                            {{ direccion.direccion.nombre }}
                            <input type="hidden" name="sedes" value="{{ direccion.direccion.nombre }}">
                        </div>
                        <div class='col-sm-4'>
                            <input type='button' value='Eliminar' onclick="eliminarSede('b-{{ direccion.id }}')" class='btn btn-xs btn-danger'>
                            <input type='hidden' id="sedeId-{{ direccion.id }}" value='hola'>
                        </div>
                        <br><hr/>
                    </div>
                {% endfor %}



            <div id="tablaSede" name="0" class="col-sm-12"></div>
            <div class="col-sm-4">

                <input type="text" name="nombreSede" class="form-control" id="inputNombreSede">
            </div>
            <div class="col-sm-8">

                <input type="text" name="locacionSede" class="form-control" id="inputSede" onkeyup="aucomloc(this.id)">
            </div>
            <div class="col-sm-6">
                <input type="button" class="btn btn-xs btn-primary" onclick="agregarSede()" value="Agregar Sede">
            </div>

        </div>
    </div>
                    <input type="submit" class="btn btn-primary" value="guardar">
</form>
{% endblock %}

{% block js %}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/maps.js"></script>
    <script type="text/javascript">
    function eliminarSede(sede){

    document.getElementById(sede).parentNode.removeChild(document.getElementById(sede));

    }
    function agregarSede(){

    var i = document.getElementById('tablaSede').getAttribute('name');
    var direccion = document.getElementById('inputSede').value;

    $.ajax({

        data:{'direc':direccion},
        url:'/agregar_sede_macrocliente_ajax/',
        type:'GET'

    }).done(function(info){

        if(document.getElementById('inputNombreSede').value != ''){

            if(info.status==1){

                i = parseInt(i);
                document.getElementById('tablaSede').innerHTML += "<div id=b-"+i+"><div id=sedeNom-"+i+" class='col-sm-4'>"+document.getElementById('inputNombreSede').value+"<input type=\"hidden\" name=\""+ document.getElementById('inputSede').value +"\" value=\""+ document.getElementById('inputNombreSede').value +"\"></div><div class='col-sm-4'>"+document.getElementById('inputSede').value+"<input type=\"hidden\" name=\"sedes\" value=\""+ document.getElementById('inputSede').value +"\"></div><div class='col-sm-4'><input type='button' value='Eliminar' onclick=eliminarSede('b-"+i+"') class='btn btn-xs btn-danger'><input type='hidden' id=sedeId-"+i+" value='hola'></div><br><hr/></div>";
                i++;
                document.getElementById('tablaSede').setAttribute('name',i);
                document.getElementById('inputNombreSede').value = '';
                document.getElementById('inputSede').value ='';

            }else{

                if(confirm("La locacion no existe!\nDesea agregar a la libreta de direcciones?")){
                    document.getElementById("dialog").innerHTML = "<iframe src='/libreta_incluida/' seamless width='100%' height='100%'></iframe>";
                    $("#dialog").dialog({title:'Agregar direccion', hide:false, height: 600, width: 900});lert("q mas?");
                }

            }

        }else{

            alert("El nombre de la sede no puede estar vacío.");

        }

    });

}

    function aucomloc(id_input){

    var ajax_loc = document.getElementById(id_input).value;
    var a=id_input;

    $.ajax({
        data:{'locacion':ajax_loc},
        url:'/locacion_ajax/',
        type:'GET'
        }).done(function(dominio){

            var locaciones_finales=[];

            for(var i=0; i<dominio.length; i++){
                locaciones_finales.push([dominio[i].fields.nombre].toString());
            }

            $('#'+a).autocomplete({
                source: locaciones_finales
            });

        });
    }
        function initialize() {
            var latlng = new google.maps.LatLng(34.0883632, -118.3788381);
            var myOptions = {
                zoom: 10,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

            createMarker(latlng);
        }

        fields = {{direcciones.count}};

        function addInput() {
          if (fields < 5) {
            var addr = document.getElementById('formatedAddress').value;
            var coord = document.getElementById('latlng').value;
            var desc = document.getElementById('descripcion').value;
            var yx = coord.split(",");
            document.getElementById('direccion').innerHTML +=
              "<div class='row form-group'><input type='text' class='form-control' size =35 name='dir' value='"+addr+"' readonly/>" +
              "<input type='text' class='form-control' name='dir' value='"+desc+"'readonly/>" +
              "<input type='hidden' name='dir' value='"+yx[0]+"'/>" +
              "<input type='hidden' name='dir' value='"+yx[1]+"'/>" +
              " <a onclick='removeInput(this.parentNode)' />remove</div>";
            fields += 1;
          } else {
            document.getElementById('warning').innerHTML =
              "Only 5 upload addresses allowed.";
            document.form.add.disabled = true;
          }
        }

        function removeInput( el ) {
          if (fields > 0) {
            document.getElementById('warning').innerHTML = "";
            var parent = document.getElementById('direccion');
            parent.removeChild(el);
            fields -= 1;
          }
        }

        function addLike(id){
          var x=document.getElementById("like").value;
          var string1 = "/add_like_edit/";
          window.location.assign(string1 + x + "-" + id)
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
{% endblock %}