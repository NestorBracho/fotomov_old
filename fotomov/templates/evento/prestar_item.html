{% extends 'tabla.html' %}
{% load bootstrap %}
{% block css %}
<link href="{{ STATIC_URL }}/css/smoothness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">
{% endblock %}
{% block titulo %}
        Items prestados
{% endblock %}
{% block tabla %}
<div class="col-md-12" style="margin-bottom: 10px">
    <div class="pull-left">
        <a href="/listar_evento/0/" class="btn btn-default"><i class="fa fa-chevron-left"></i> Listar eventos</a>
    </div>
    <div class="pull-right">
        <a href="/listar_items_prestados/{{ evento }}/" class="btn btn-info">Inventario/Prestar</a>
    </div>
</div>
<table class="table table-striped  table-hover" id="content">
    <thead>
        <th>Item</th>
        <th>Cantidad</th>
        <th>Acciones</th>
    </thead>
    <tbody>
    {% for item in items %}
        <tr id="{{ item.id }}">
            <td>{{ item.item }}</td>
            <td>{{ item.cantidad}}</td>
            <td>
                <a onclick="set_item({{ item.id }})" data-toggle="modal" data-target="#prestar" class="btn btn-xs btn-default">Prestar</a>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<div class="modal fade" id="prestar" tabindex="-1" role="dialog" aria-labelledbby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-img">
        <div class="modal-content">
            <div class="modal-header" id="modal-header">
                <button id="close" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4>A quien se lo vas a prestar</h4>
            </div>
            <div class="modal-body text-center" id="modal-body">
                <input type="text" class="form-control prestado" placeholder="A quien se lo vas a prestar..."
                       id="usuario_input"/>
            </div>
            <div class="modal-footer text-center" id="modal-footer">
                <input type="hidden" id="id_usuario"/>
                <a onclick="" data-dismiss="modal" aria-hidden="true" class="btn btn-primary pull-right button_prestar">Prestar</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script type="text/javascript">

    function set_item(idItem){
        $('.button_prestar').attr('onclick', 'prestar_item('+idItem+')');
    }

    function prestar_item(idItem){
        prestado = $('.prestado').val();
        evento = {{ evento }};
        $.ajax({
            url:'/prestar_item_seleccionado/',
            data:{'iden': idItem, 'per': prestado, 'evento': evento},
            type:'GET'
        }).done(function(data){
            $("#"+idItem).fadeOut();
        });
    }

    $('#usuario_input').autocomplete({
        source: function(request, response){
            $.get(
                '/traer_usuario_gasto_evento_ajax/',
                {
                    usu: request.term
                },
                function(data){
                    response(data);
                }
            );
        },
        focus: function( event, ui ) {
            $( this ).val( ui.item.label );
            return false;
        },
        select: function( event, ui ) {
            $( this ).val( ui.item.label );
            $( "#id_usuario").val( ui.item.value );

            return false;
        }
    })
    .data( "ui-autocomplete" )._renderItem = function( ul, item ) {
        return $( "<li>" )
            .append( "<a>" + item.label + "<br>" + item.desc + "</a>" )
            .appendTo( ul );
    };

</script>
{% endblock %}
