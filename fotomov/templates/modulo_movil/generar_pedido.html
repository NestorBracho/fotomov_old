{% extends 'tabla.html' %}
{% load bootstrap %}
{% load widget_tweaks %}
{% block css %}
<link href="{{ STATIC_URL }}css/smoothness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">
<style type="text/css" xmlns="http://www.w3.org/1999/html"></style>
{% endblock %}
{% block titulo %}
Generar pedido
{% endblock %}
{% block seccion-contenido%}
<form id="generar_pedido" method="POST">{% csrf_token %}
    <div class="col-xs-12 col-md-6">
        {% if cliente == None %}
        <div class="datos_cliente">
            <div class="col-xs-12 col-md-12">
                <div class="form-group">
                    <label class="control-label" for="id_nombres_cliente">Nombres</label>
                    <input type="text" id="id_nombres_cliente" name="nombres_cliente" class="form-control">
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="form-group">
                    <label class="control-label" for="id_apellidos_cliente">Apellidos</label>
                    <input type="text" id="id_apellidos_cliente" name="apellidos_cliente" class="form-control">
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="form-group ">
                    <label class="control-label" for="id_cedula_cliente">Número de cedula del cliente</label>
                    <input type="text" id="id_cedula_cliente" name="cedula_cliente" class="form-control">
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="form-group ">
                    <label class="control-label" for="id_rif_cliente">R.I.F. del cliente</label>
                    <input type="text" id="id_rif_cliente" name="rif_cliente" class="form-control">
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="form-group">
                    <label class="control-label" for="id_telefono_cliente">Número telefono del cliente</label>
                    <input type="text" id="id_telefono_cliente" maxlength="11" name="telefono_cliente" class="form-control">
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="form-group">
                    <label class="control-label" for="id_mail_cliente">Email del cliente</label>
                    <input type="text" id="id_mail_cliente" name="mail_cliente" class="form-control">
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="form-group">
                    <label class="control-label" for="id_direccion_fiscal_cliente">Direccion fiscal del cliente</label>
                    <textarea id="id_direccion_fiscal_cliente" name="direccion_fiscal_cliente" class="form-control" ></textarea>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-xs-12 col-md-12 table-responsive">
            <table class="table ">
                <thead><th id="id_nombres_cliente" colspan="2">{{ cliente.nombres }} {{ cliente.apellidos }}</th><th colspan="2" id="id_cedula_cliente">{{ cliente.cedula }}</th></thead>
                <tr><td>Email:</td><td id="id_mail_cliente">{{ cliente.email }}</td><td>Telefono:</td><td id="id_telefono_cliente" value="{{ cliente.telefono }}">{{ cliente.telefono }}</td></tr>
                <tr><td>Direccion:</td><td id="id_direccion_fiscal_cliente">{{ cliente.direccion_fiscal }}</td><td>Rif:</td><td id="id_rif_cliente" >{{ cliente.rif }}</td></tr>
            </table>
        </div>
        {% endif %}
        <div class="col-xs-12 col-md-12">
            <div class="checkbox">
                <label>
                    <input type="checkbox" id="checkbox_direccion">Factura personal<br>
                </label>
            </div>
        </div>
        <div class="datos_juridicos">
            <div class="col-xs-12 col-md-12">
                {{ formulario.id_fiscal | bootstrap}}
            </div>
            <div class="col-xs-12 col-md-12">
                {{ formulario.tlf_fiscal | bootstrap}}
            </div>
            <div class="col-xs-12 col-md-12">
                {{ formulario.razon_social | bootstrap}}
            </div>
            <div class="col-xs-12 col-md-12">
                {{ formulario.direccion_fiscal | bootstrap}}
            </div>
        </div>
            <table class="table">
                <thead><th class="col-xs-9 col-md-9">Tipo de envio</th><th class="col-xs-3 col-md-3">Precio</th></thead>
                <tr>
                    <td>
                        <div>
                            {{ formulario.envio |add_class:"form-control" }}
                        </div>
                    </td>
                    <td>
                        <span class="costo_envio">0.0</span>
                    </td>
                </tr>
            </table>
            <div id="dir_envio" class="col-xs-12 col-md-12" style="display: none;">
                <label class="control-label  " for="id_direccion_entrega">Direccion entrega</label>
                    <div class=" ">
                        <textarea class=" form-control" cols="40" id="id_direccion_entrega" name="direccion_entrega" rows="10">{{ pedido_actual.direccion_entrega }}</textarea>
                    </div>
            </div>
        <div class="col-xs-12 text-right">
                <input type='button' onclick="generarPedido()" class="btn btn-default btn-primary" value='Generar'/>
            <div class="col-md-6 hidden-xs hidden-sm"></div>
        </div>
    </div>
    <div class="col-xs-12 col-md-6 table-responsive">
        <table class="table " id="tabla-productos">
            <thead><th>Cant.</th><th>Produc.</th><th>Precio Und.</th><th>Eliminar</th></thead>
            {% for producto in productos %}
            <tr id="tr-{{ producto.id }}" class="producto">
                <td><input id="cant-{{ producto.id }}" class="form-control cant-prod" name="cant-{{ producto.id }}" type="number" value="{{ producto.cantidad }}"></td>
                <td><select id="prod-{{ producto.id }}" class="form-control prod" name="prod-{{ producto.id }}" onchange="actualizar_total()">
                    {% for product in en_venta %}
                        {%  if not product.es_combo %}
                            {% if product.id == producto.producto.id %}
                                <option value="{{ product.id }}-{{ product.precio }}" selected>{{ product.producto.nombre }}</option>
                            {% else %}
                                <option value="{{ product.id }}-{{ product.precio }}">{{ product.producto.nombre }}</option>
                            {% endif %}
                        {% endif %}

                    {% endfor %}
                </select></td>
                <td id="total-{{ producto.id }}">{{ producto.producto.precio }}</td>
                <td class="text-center" id="borrar-{{ producto.id }}"></td>
            </tr>
            {% endfor %}
        </table>
        <table class="table " id="tabla-combos">
            {% for combo in combos %}
                <tbody class="combo-{{ combo.id }}">
                    <tr id="tr-{{ combo.id }}">
                        <td><input id="cant-{{ combo.id }}" class="form-control cant-combo" name="cant-{{ combo.id }}" type="number" value="{{ combo.cantidad }}"></td>
                        <td>{{ combo.producto.producto.nombre }}</td>
                        <td id="total-{{ combo.id }}" class="precio-combo">{{ combo.producto.precio }}</td>
                        <td class="text-center" id="borrar-{{ combo.id }}"></td>
                    </tr>
                    {% for producto in combo.productos %}
                        <tr>
                            <td class="cant-prod-combo">{{ producto.cantidad }}</td>
                            <td class="prod-combo">{{ producto.producto.producto.nombre }}</td>
                            <td></td>
                            <td></td>
                        </tr>
                    {% endfor %}
                </tbody>
            {% endfor %}
        </table>
    </div>
    <div class="col-xs-12 col-md-6">
        <table class="table">
            <thead><th>Sub Total</th><th>Descuento</th><th>IVA</th><th>Total</th><th>Faltan</th></thead>
            <tr>
                <td><input class="form-control" type="text" name="total_input" id="total_input"></td>
                <td><input class="form-control" type="text" name="descuento_input" id="descuento_input" value="0.0"></td>
                <td id="iva">{{ iva.valor }}</td>
                <td id="total"><input type="hidden"</td>
                <td id="faltan"></td>
            </tr>
        </table>
    </div>



    <div class="col-xs-12 col-md-6 table-responsive">
    {% if mensaje.error %}
    <div class="alert alert-danger">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="True">&times;</button>
        {{ mensaje.text }}
    </div>
    {% endif %}
    <div id="formsets">
        {{ pagosForms.management_form }}
        {% for form in pagosForms %}
            <div class="formset_pago">
            {{ form.tipo_pago | bootstrap }}
            {{ form.referencia | bootstrap }}
            <div class="row">
                <div class="col-md-12 monto">
                    {{ form.monto|add_class:"monto_pago"|attr:"value:0.0"|bootstrap }}
                </div>
                <div class="col-md-4 vuelto" style="display: none;">
                    <div class="form-group">
                        <label class="control-label">Vuelto</label>
                        <div class=" ">
                            <input class="form-control monto_vuelto" type="text" readonly>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        {% endfor %}

    </div>
    <div class="col-xs-12 col-md-6">
        <button type="button" id="agregar_pago" class="btn btn-default">Agregar otro pago</button>
    </div>

        <!--  <table id="tipos_pagos" class="table ">
            <thead><th>Tipo</th><th>Monto</th><th>Referencia</th><th>Eliminar</th></thead>
            <tr>
                <td name="tipo" >
                    <select class="form-control">
                    </select>
                </td>
                <td name="monto"><input size="1" style="font-size:24px;" class=" form-control" type="text"></td>
                <td name="referencia"><input class=" form-control" type="text"></td>
                <td><input class=" form-control" type="text"><</td>
            </tr>
        </table> -->
        <!--<span id="total"></span> -->
    </div>
</form>

<div class="modal fade" id="Foto" tabindex="-1" role="dialog" aria-labelledbby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-img">
        <div class="modal-content">
            <div class="modal-header" id="modal-header">
                <button id="close" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body text-center" id="modal-body">
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block js %}
<script src="{{STATIC_URL}}js/agregar_formsets.js"></script>
<script>
    function numero(e) {
          var codigo;
          codigo = (document.all) ? e.keyCode : e.which;
          if (codigo > 31 && (codigo < 48 || codigo > 57) ) {
          return false;
          }
          return true;
    }
</script>
<script>
    function numero_float(e) {
          var codigo;
          codigo = (document.all) ? e.keyCode : e.which;
          if (codigo > 31 && (codigo < 48 || codigo > 57) && codigo != 46) {
          return false;
          }
          return true;
    }
</script>
<script type="text/javascript">
var costo_productos = {};
var cantidad_productos = {};
var prod_combos = {};
var costo_combos = 0;
window.onload = function(){
    var subtotal, total = 0, url_aux;

    {% if cliente == None %}
        $('#id_cedula_cliente').val("{{ ced }}");
    {% endif %}

    {% for producto in productos %}
        url_aux = "{{ producto.ruta }}";
        url_aux = url_aux.split('/fotomov_imagenes/');
        url_aux = url_aux[1];
        var url_final = {{MEDIA_URL}}+url_aux;
        url_final= encodeURI(url_final);
        var elem = "<a data-toggle=\"modal\" data-target=\"#Foto\" onclick=abrirFoto('";
        elem += url_final;
        elem += "') ><img src=\""+url_final+"\" width=\"50\"></a> <a class=\"btn btn-default btn-xs btn-danger\" onclick=borrarProducto(\"tr-{{ producto.id }}\")>Eliminar</a>";
        $('#borrar-{{ producto.id }}').html(elem);

    {% endfor %}


    {% for producto in combos %}
        url_aux = "{{ producto.ruta }}";
        url_aux = url_aux.split('/fotomov_imagenes/');
        url_aux = url_aux[1];

        $('#borrar-{{ producto.id }}').html('<a class=\"btn btn-default btn-xs btn-danger\" onclick=borrarCombo("tr-{{ producto.id }}")>Eliminar</a>');
    {% endfor %}



    $('#id_form-TOTAL_FORMS').val(1);


}


$(document).ready(function(){
    // Objeto JSON con los tipos de envio, sus precios y si es requerido dir de envio
    var $tiposenvio = {{ tipos_envio|safe }};
    for(var env in $tiposenvio){
        $('.costo_envio').html($tiposenvio[env].precio);
        break;
    }
    // Funcion cuando se cambia el tipo de envio.
    // Si es necesaria una dirección, se muestra el campo.
    $( '#id_envio' ).on('change', function(event){
        var i = $(this).val();
        if ($tiposenvio[i].req_dir == true){
            $('#dir_envio').show(200);
        } else {
            $('#dir_envio').hide(200);
            $('#id_direccion_entrega').val('');
        }
        $('.costo_envio').html(parseFloat($tiposenvio[i].precio));
        actualizar_total();
    })

    var options = [
        {
          label: '---------',
          value: ''
        },
        {% for tipo_pago in tipos_pago %}
            {
                label: '{{tipo_pago}}',
                value: {{tipo_pago.id}},
                discount: '{{ tipo_pago.descuento }}'

            },
        {% endfor %}
   ]

    // Funciones para las acciones de los formsets
    $('#agregar_pago').on('click',function(event){
        event.preventDefault();
        agregarFormset(options);
    });


  $("#id_form-0-tipo_pago").change(function(){
        verificar("0")
  });

  $("#id_tipo_pago").change(function(){
      if (document.getElementById("id_tipo_pago").value == ""){
          $("#tipo_pago").hide();
      }else{
          $("#tipo_pago").show();
      }

  });
    $(".cant-prod").each(function(){
        $(this).data("previous-value", $(this).val());
    });
    $(".cant-combo").each(function(){
        $(this).data("previous-value", $(this).val());
    });
    $(".prod").each(function(){
        $(this).data("previous-value", $(this).val());
    });
    verificar("0");
    $('.monto_pago').val($('#total').html());
});

$(".cant-prod").change(function() {
    if ($(this).val() < 0) {
        $(this).val($(this).data("previous-value"));
    } else {
        var id = $(this).attr('id').split("-");
        id = id[1];
        var producto = $('#prod-'+id+' :selected');
        producto = producto.text();
        actualizar_total();
        if (cantidad_productos[producto] < prod_combos[producto]){
            alert('No puede reducir la cantidad de '+producto+' porque son parte de un combo.');
            $(this).val($(this).data("previous-value"));
            actualizar_total();
        } else {
            $(this).data("previous-value", $(this).val());
            actualizar_total();
        }
    }
});

$('#checkbox_direccion').change(function(){
    var elem = $('.datos_juridicos');
    elem.toggle(500);
});

$(".cant-combo").change(function() {
    if ($(this).val() < 0) {
        $(this).val(0);
    } else {
        var cant_combo = parseInt($(this).val());
        var pass = true;
        actualizar_total();
        $.each(prod_combos, function(key, value){
            if (value > cantidad_productos[key]){
                alert('Tiene que agregar más ' + key + ' para poder aumentar el combo.');
                pass = false;
            }
        });
        if (pass == false){
            $(this).val($(this).data("previous-value"));
        } else {
            $(this).data("previous-value", $(this).val());
        }
        actualizar_total();
    }
});

// Si se cambia un producto, se verifica que se pueda cambiar y se actualiza el
// diccionario de cantidades. Si no se puede cambiar, se revierte al anterior.
$(".prod").change(function() {
    cantidad_productos = {};
    var prod = $(this);
    $('.producto').each(function(){
        var id = $(this).attr('id').split("-");
        id = id[1];
        var producto = $('#prod-'+id+' :selected');
        var nombre = producto.text();
        var cantidad = parseInt($('#cant-'+id).val());
        if (nombre in cantidad_productos){
            cantidad_productos[nombre] += cantidad;
        } else {
            cantidad_productos[nombre] = cantidad;
        }
    });
    $.each(cantidad_productos, function(key, value){
        if (key in prod_combos){
            if (prod_combos[key] > value){
                alert('No se puede cambiar el producto porque es parte de un combo.');
                prod.val(prod.data("previous-value"));
                actualizar_total();
                return false;
            }
        }
    });
    $(this).data("previous-value", $(this).val());
    actualizar_total();
});

// Funcion para calcular el vuelto y cuanto falta por pagar.
$(document).on("change", ".monto_pago", function(){
    var suma = 0;
    $('.monto_pago').each(function(){
        suma += parseFloat($(this).val());
    });
    var elem = $(this).parents('.row').find('.monto_vuelto');
    elem.val((suma - parseFloat($('#total').html())).toFixed(2));

    var total = parseFloat($('#total').html());
    $('#faltan').html((total-suma).toFixed(2));
});

$("#descuento_input").change(function() {
    if ($(this).val() < 0 || $(this).val() > parseFloat($('#total_input').val())) {
        $(this).val(0);
    } else {
        var iva = $('#iva').html().split('%');
        var total = ((parseFloat($('#total_input').val()) - parseFloat($(this).val()))*(parseFloat('1.'+iva))).toFixed(2)
        iva = iva[0];
        $('#total').html(total);
        var pagos = 0;
        $('.monto_pago').each(function(){
            pagos += parseFloat($(this).val());
        });
        $('#faltan').html((total-pagos).toFixed(2));
    }
});

function actualizar_total(){
    // "Diccionario" de cada producto con su costo
    costo_productos = {};
    // "Diccionario" de cada producto con su cantidad
    cantidad_productos = {};
    // "Diccionario" de cuantos items para cada producto son parte de un combo
    prod_combos = {};
    costo_combos = 0;

    // Para cada producto se guarda el costo y la cantidad en el diccionario respectivo.
    $('.producto').each(function(){
        var id = $(this).attr('id').split("-");
        id = id[1];
        var producto = $('#prod-'+id+' :selected');
        var costo = producto.val().split('-');
        costo = costo[1];
        var nombre = producto.text();
        var cantidad = parseInt($('#cant-'+id).val());
        costo_productos[nombre] = parseFloat(costo);
        if (nombre in cantidad_productos){
            cantidad_productos[nombre] += cantidad;
        } else {
            cantidad_productos[nombre] = cantidad;
        }
    });
    // Se buscan cuantos productos son parte de combos
    $('.prod-combo').each(function(){
        if ($(this).html() in prod_combos){
            prod_combos[$(this).html()] += (parseInt($(this).prev().html()) * parseInt($(this).parents('tbody').find('.cant-combo').val()));
        } else {
            prod_combos[$(this).html()] = (parseInt($(this).prev().html()) * parseInt($(this).parents('tbody').find('.cant-combo').val()));
        }
    });

    var total = 0;
    // Se calcula el total de los productos restandole la cantidad que pertenecen a un combo
    $.each(costo_productos, function(key, value){
        if (key in prod_combos){
            total += (cantidad_productos[key] - prod_combos[key]) * value;
        } else {
            total += cantidad_productos[key] * value;
        }
    });

    // Se suman costo de los combos, se le suma el iva, costo de envío y se imprime
    // el total en el campo respectivo.
    $('.cant-combo').each(function(){
        costo_combos += parseInt($(this).val()) * parseInt($(this).parent().siblings('.precio-combo').html());
    });
    total = total + costo_combos + parseFloat($('.costo_envio').html());
    $('#total_input').val(total);
    var iva = $('#iva').html().split('%');
    iva = iva[0];
    total -= $('#descuento_input').val();
    total = (total * (parseFloat('1.'+iva))).toFixed(2);
    $('#total').html(total);
    var pagos = 0;
    $('.monto_pago').each(function(){
        pagos += parseFloat($(this).val());
    });
    $('#faltan').html((total-pagos).toFixed(2));
}

function verificar(idElem){
    var options = [
        {% for tipo_pago in tipos_pago %}
            {% if tipo_pago.descuento == False %}
                {{ tipo_pago.id }},
            {% endif %}
        {% endfor %}
    ]
    var flag = "True";
    var efectivo = false;
    var total = parseInt($('#id_form-TOTAL_FORMS').val(),10);
    var i = 0;

    while (i<total){
        var elem = $('#id_form-'+i+'-tipo_pago :selected');
        var paid = elem.val();
        $.each(options, function(index, option){
           if (option == paid){
               flag="False";
           }
        });
        if (elem.html() == "Efectivo"){
            if (efectivo == true){
                alert('No pueden haber dos pagos en efectivo.');
                $('#id_form-'+idElem+'-tipo_pago').val('');
                var elem_monto = $('#id_form-'+idElem+'-monto').parents('div.monto');
                elem_monto.next().hide();
                elem_monto.attr('class', 'col-md-12 monto');
            } else {
                var elem_monto = $('#id_form-'+i+'-monto').parents('div.monto');
                elem_monto.attr('class', 'col-md-8 monto');
                elem_monto.next().show(500);
            }
            efectivo = true;
        } else {
            var elem_monto = $('#id_form-'+i+'-monto').parents('div.monto');
            elem_monto.next().hide();
            elem_monto.attr('class', 'col-md-12 monto');
        }
        i++;
    }
    if (flag == "False"){
        $('.cant-combo').each(function(){
            $(this).data("previous-value", $(this).val());
            $(this).val(0);
        });
        actualizar_total();
        $('#tabla-combos').hide(500);
        document.getElementById('descuento_input').readOnly = true;
    }else{
        document.getElementById('descuento_input').readOnly = false;
        $('#tabla-combos').show(500);
        $('.cant-combo').each(function(){
            $(this).val($(this).data("previous-value"));
        });
        actualizar_total();
    }
    {% comment %}for (var i = 0, len = options.length, text = ""; i < len; i++) {
        text += cars[i] + "<br>";
    }{% endcomment %}
}

function borrarProducto(iden){

    var idPEV = iden.split('-');
    idPEV = idPEV[1];

    var cant  = $('#cant-'+idPEV);
    cant.val(0);
    var producto = $('#prod-'+idPEV+' :selected');
    producto = producto.text();
    actualizar_total();
    if (producto in cantidad_productos) {
        if (cantidad_productos[producto] < prod_combos[producto]){
            alert('No puede eliminar '+producto+' porque son parte de un combo.');
            cant.val(cant.data("previous-value"));
            actualizar_total();
            return false;
        }
    }
    if(confirm("¿Esta seguro que desea borrar este producto del pedido?")){
        $.ajax({

            url:'/eliminar_productoeventopedido_en_generarpedido/',
            data:{'iden': idPEV},
            type:'GET'

        }).done(function(data){

            $("#"+iden).fadeOut();
            window.setTimeout(function(){document.getElementById(iden).parentNode.removeChild(document.getElementById(iden))},3000);

        });
    } else {
        cant.val(cant.data("previous-value"));
        actualizar_total();
    }
}

function borrarCombo(iden){

    var idPEV = iden.split('-');
    idPEV = idPEV[1];
    var cant  = $('#cant-'+idPEV);
    cant.val(0);
    actualizar_total();
    if(confirm("¿Esta seguro que desea borrar este combo del pedido?")){
        $.ajax({

            url:'/eliminar_productoeventopedido_en_generarpedido/',
            data:{'iden': idPEV},
            type:'GET'

        }).done(function(data){
            var quitar = $("#"+iden).parents('tbody');
            quitar.fadeOut();
            quitar.remove();

        });
    } else {
        cant.val(cant.data("previous-value"));
        actualizar_total();
    }
}

function abrirFoto(url){
    $('#modal-body').html('<img src='+url+'></img>');

}

function costo_envio(){

}

function generarPedido(){
    var monto = 0;
    var pass = true;
    var efectivo = false;
    // Se revisa si la suma de los montos de pago son igual al total del pedido
    $('.formset_pago').each(function(){
        var select = $(this).find('select :selected');
        if (select.html() != "---------"){
            if (select.html() == "Efectivo"){
                efectivo = true;
            }
            var id = $(this).find('select').attr('id');
            id = id.split('-');
            id = id[1];
            monto += parseFloat($('#id_form-'+id+'-monto').val());
        }
    });
    var total = parseFloat($('#total').html());
    if (monto != total && !efectivo) {
        alert('La suma de los montos no coinciden con el total del pedido.')
        pass = false;
    } else if (monto < total && efectivo){
        alert('La suma de los montos no coinciden con el total del pedido.')
        pass = false;
    }

    if ($('#dir_envio').is(":visible") && $('#id_direccion_entrega').val() == '') {
        alert('La dirección de entrega no puede estár vacía');
        pass = false;
    }

    // Si es factura personal, se duplican los datos del cliente a los datos fiscales
    if(!($('.datos_juridicos').is(":visible"))){
        if($('#id_cedula_cliente').val() === ''){
            $('#id_id_fiscal').val($('#id_cedula_cliente').html());
            $('#id_tlf_fiscal').val($('#id_telefono_cliente').html());
            $('#id_razon_social').val($('#id_nombres_cliente').html());
            $('#id_direccion_fiscal').val($('#id_direccion_fiscal_cliente').html());
        } else {
            $('#id_id_fiscal').val($('#id_cedula_cliente').val());
            $('#id_tlf_fiscal').val($('#id_telefono_cliente').val());
            $('#id_razon_social').val(($('#id_nombres_cliente').val()).concat($('#id_apellidos_cliente').val()));
            $('#id_direccion_fiscal').val($('#id_direccion_fiscal_cliente').val());
        }
    }
    if (pass == true) {
        document.getElementById('generar_pedido').submit();
    }
}

$("#id_mail_cliente").on('keyup',aucomemail);

function aucomemail(){

  var dominios, dom;

  $(function(){

    dominios = [
        document.getElementById("id_mail_cliente").value+"@gmail.com",
        document.getElementById("id_mail_cliente").value+"@hotmail.com",
        document.getElementById("id_mail_cliente").value+"@yahoo.com",
        document.getElementById("id_mail_cliente").value+"@turpialdev.com"
    ];

    $("#id_mail_cliente").autocomplete({
        source: dominios
    });

    if(document.getElementById("id_mail_cliente").value.indexOf("@") != -1){
        if(document.getElementById("id_mail_cliente").value.indexOf("@")+1==document.getElementById("id_mail_cliente").value.length){
            dom = [
                      document.getElementById("id_mail_cliente").value+"gmail.com",
                      document.getElementById("id_mail_cliente").value+"hotmail.com",
                      document.getElementById("id_mail_cliente").value+"yahoo.com",
                      document.getElementById("id_mail_cliente").value+"turpialdev.com"
            ];
        }
        $('#id_mail_cliente').autocomplete({
           source: dom
        });
      }
  });
}

</script>
{% endblock %}