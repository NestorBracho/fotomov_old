{% extends 'tabla.html' %}
{% load bootstrap %}
{% block titulo %}

{% endblock %}
{% block seccion-contenido%}
<div class="col-xs-12 col-md-12 table-responsive">
    <table class="table table-bordered">
        <thead><th>Foto</th><th>Producto</th><th>Cantidad</th><th>Comentarios</th><th>Estado</th></thead>
        <tbody id="body-edicion">
        {% for producto in edicion %}
        <tr><td id="img-{{producto.id}}"></td><td>{{ producto.producto.producto.nombre }}</td><td>{{ producto.cantidad }}</td><td><a class="btn btn-xs btn-default" data-toggle="modal" data-target="#Comentarios" onclick=verComentario('{{ producto.id }}') >Ver</a></td><td id="estado-{{ producto.id }}"><a class="btn btn-xs btn-danger" onclick=estadoListo('{{ producto.id }}') >Pendiente</a></td></tr>
        {% endfor %}
        {% for editado in editados %}
        <tr><td id="img-{{editado.id}}"></td><td>{{ editado.producto.producto.nombre }}</td><td>{{ editado.cantidad }}</td><td><a class="btn btn-xs btn-default" data-toggle="modal" data-target="#Comentarios" onclick=verComentario('{{ editado.id }}') >Ver</a></td><td id="estado-{{ editado.id }}">Listo</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="Comentarios" tabindex="-1" role="dialog" aria-labelledbby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" id="modal-header">
                <button id="close" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body text-center" id="modal-body">
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script type="text/javascript">

window.onload = function(){

    var url_aux;

    {% for producto in edicion %}

        url_aux = "{{ producto.ruta }}";
        url_aux = url_aux.split('/fotomov_imagenes/');
        url_aux = url_aux[1];

        $('#img-{{ producto.id }}').html('<img src="{{MEDIA_URL}}'+url_aux+'" width="50"></img>');

    {% endfor %}

    {% for editado in editados %}

        url_aux = "{{ editado.ruta }}";
        url_aux = url_aux.split('/fotomov_imagenes/');
        url_aux = url_aux[1];

        $('#img-{{ editado.id }}').html('<img src="{{MEDIA_URL}}'+url_aux+'" width="50"></img>');

    {% endfor %}

}

function verComentario(iden){

    $('#modal-body').html('El campo \"comentario\" en la tabla de orden d compras (EventoProductoPedido) no exite. Crear');

}

function estadoListo(iden){

    if(confirm("Una vez que el estado pase a Listo, no podras revertirlo.\nÂ¿Estas seguro que esta foto ya esta editada?")){

        $.ajax({

            url:'/cambiar_estado_producto_edicion->editado/',
            data:{'iden':iden},
            type:'get'

        }).done(function(data){

            $('#estado-'+iden).html('Listo');

        });

    }

}

</script>
{% endblock %}