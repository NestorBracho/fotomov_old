{% extends 'tabla.html' %}
{% load bootstrap %}
{% block css %}
<!--http://w3widgets.com/responsive-calendar/-->
<link href="{{ STATIC_URL }}css/fullcalendar.css" rel="stylesheet">
{% endblock %}
{% block titulo %}
Todas las tareas
{% endblock %}
{% block seccion-contenido%}
<ul class="nav nav-tabs">
  <li class="active"><a href="#lista" class="btn" data-toggle="tab">Lista</a></li>
  <li><a href="#calendario" class="btn" data-toggle="tab">Calendario</a></li>
</ul>
<div class="tab-content">
    <div class="tab-pane active" id="lista">
        <div class="col-md-12" style="margin-top: 10px">
            <table class="table table-striped table-hover" id="content">
                <thead>
                    <th>Estado</th>
                    <th>Tarea</th>
                    <th>Contenido</th>
                    <th>Asociado a...</th>
                    <th>Antes del...</th>
                    <th>Realizada el...</th>
                </thead>
                {% for tarea in tareas %}
                <tr id='trTarea-{{ tarea.id }}'>
                    <td>
                        <button onclick="listoL(this.name,{{ tarea.id }})" {% if tarea.lista == "True" %} name = '1'{% else %}name = '2'{% endif %} class="checkmark {% if tarea.lista == "True" %} listo{% endif %}" id='checkt-{{ tarea.id }}' {% if tarea.lista == "None" %}style='display:None'{% endif %}></button>
                        {# <button onclick="listoL(this.name,{{ tarea.id }})" {% if tarea.lista == "True" %} name = '1'{% else %}name = '2'{% endif %} class="checkmark {% if tarea.lista == "True" %} listo{% endif %} {% if tarea.lista == "None" %} no-aplica {% endif %}" id='checkt-{{ tarea.id }}' ></button> #}
                        <a onclick="listoL('0',{{ tarea.id }})" id='NA-{{ tarea.id }}' class="no-aplica btn-xs btn btn-default">{% if tarea.lista == "None" %}S&iacute; Aplica{% else %}<i class="fa fa-times"></i> No aplica{% endif %}</a>
                    </td>
                    <td><a class="datos" href="/ver_tarea/{{ tarea.id }}">{{tarea.nombre}}</a></td>
                    <td>{{tarea.tarea}}</td>
                    <td>{{tarea.evento}}</td>
                    <td>{{tarea.fecha}}</td>
                    <td>{{ tarea.fecha_realizada }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <div class="tab-pane" id="calendario">
        <div class="col-md-12" style="padding-top: 10px">
            <div id="calendar">
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script type="text/javascript" src="{{ STATIC_URL }}/js/moment.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}/js/fullcalendar.min.js"></script>
<script type="text/javascript">

$("#calendar").fullCalendar({
    events: function(start, end, timezone, callback){

        var events = [];

        {% for tarea in tareas %}
            events.push({
                id : '{{ tarea.id }}',
                title  : '{{ tarea.nombre }}',
                start : '{{ tarea.fecha|date:"c" }}',
                url : '/ver_tarea/{{ tarea.id }}'
            });
        {% endfor %}

        callback(events);

    }
  });

window.onload = function(){

    var tarea_id, stat;

    {% for stat in stats %}

        tarea_id = "{{ stat }}".split("-");
        stat = tarea_id[0]
        tarea_id = tarea_id[1];
        if(stat == "1"){
            $("#trTarea-"+tarea_id).addClass("maniana");
        }else if(stat == "2"){
            $("#trTarea-"+tarea_id).addClass("hoy");
        }else if(stat == "3"){
            $("#trTarea-"+tarea_id).addClass("vencido");
        }

    {% endfor %}

}

function listoL(stado,tarea){

    $.ajax({

        data:{estado:stado, tarea:tarea},
        url:'/modificar_estado_tarea/',
        type:'GET',
        error:function(a,b,c){

            $('#alertas-ajax').addClass('alert');
            $('#alertas-ajax').addClass('alert-danger');
            document.getElementById('alertas-ajax').innerHTML = "<button type='button' class='close' data-dismiss='alert' aria-hidden='True'>&times;</button>Hubo un error de comunicaci√≥n "+c+"</div>"
            console.log(c);

        }

    }).done(function(data){

        if(data.status == 'True'){

            $("#checkt-"+tarea).addClass("listo");
            $("#checkt-"+tarea).attr('name','1');

        }else if(data.status == 'False'){
			$("#checkt-"+tarea).removeClass("no-aplica");
            $("#checkt-"+tarea).removeClass("listo");
/*             $("#checkt-"+tarea).fadeIn(); */
            document.getElementById('NA-'+tarea).innerHTML = '<i class="fa fa-times"></i> No aplica';
            $("#checkt-"+tarea).attr('name','2');

        }else if(data.status == "None"){

/*             $("#checkt-"+tarea).fadeOut(); */
			$("#checkt-"+tarea).addClass("no-aplica");
            document.getElementById('NA-'+tarea).innerHTML = "S&iacute; Aplica";
            //$("#trTarea-"+tarea).fadeOut();

        }

    });

}

</script>
{% endblock %}